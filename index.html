<html>
<meta name="viewport" content="width=device-width, initial-scale=1">
    <head>

        <!-- load styles-->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>

        <link rel="stylesheet" href="styles.css">

        <!-- load leaflet -->
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    </head>

    <body>
        <label for="cars">Choose an election:</label>
        <select name="cars" id="cars">
        <option value="2019">2019</option>
        <option value="2017">2017</option>
        </select>

        <div id="map"></div>

        <button class="btn reset-btn" id="all">Reset</button>

        <script>
          
            // MUST BE WGS84 - transformed and set in SF
             var map = L.map('map').setView([0.3149999 , 0.41 ],10);
             var layerGroup2019 = new L.layerGroup();
    
            var map_url = "https://raw.githubusercontent.com/pollockl-parl/d3/main/results_2019.geojson";
            var tooltip = L.tooltip()
                .setLatLng([49.767122, -7.556727])
                .setContent('Hello world!<br />This is a nice tooltip.')
                .addTo(map);

            // styling / formatting functions    

            function getPartyColour(r) {
                switch (r) {
                    case "Con": return "blue";
                    case "Lab" : return "red";
                    case "SNP" : return "yellow";
                    case "LD" : return "orange";
                    case "DUP" : return "#D46A4C"
                    default : return "grey";
                }
            }

            function getPartyBorderColour(r) {
                switch (r) {
                    case "Con": return "#00008B";
                    case "Lab" : return "#8B0000";
                    case "SNP" : return "#8B8000";
                    case "LD" : return "d#ff8c00";
                    case "DUP" : return "#D46A4C"
                    default : return "darkgrey";
                }
            }

            function getBorderWeight(b) {

                if (b.includes("gain")) {
                    return 3
                } else {
                    return 1
                }
            }
            

            function styler(feature) {
                return {
                    fillColor: getPartyColour(feature.properties.first_party),
                    weight: getBorderWeight(feature.properties.result),
                    opacity: 1,
                    color: getPartyBorderColour(feature.properties.first_party),
                    //dashArray: '3',
                    fillOpacity: 1
                };
            }
            
            $.getJSON(map_url, function(data) {
              var features2019 =
              L.geoJson(data, {
                    style: styler,
                    onEachFeature: function(feature, layer) {
                        layer.on("mouseover", function() {$(".leaflet-tooltip").css("display","block")});
                        layer.on("mousemove", function(e) {
                            tooltip.setLatLng(e.latlng).setContent(feature.properties.result)
                        });
                        layer.on("mouseout", function() {$(".leaflet-tooltip").css("display","none")});
                    }
                    }
                    
                );
                layerGroup2019.addLayer(features2019)
                layerGroup2019.addTo(map);
                });
        
                document.getElementById("all").addEventListener('click', function (event) {

                    map.setView([0.3149999 , 0.41 ],10);
                    map.hideLayer(layerGroup2019);

                    //map.eachLayer(function (layer) {
                    //     map.removeLayer(layer);
                    //   });
                });        
        </script>
    </body>
</html>